#!/usr/bin/env ruby
require 'optparse'
require 'GeneValidatorApp'
require 'GeneValidatorApp/version'

require 'sinatra'
require 'pathname'

opt = {}
optparse = OptionParser.new do |opts|
  opts.banner = <<Banner

* Usage: genevalidatorapp [options]

* Available Options

Banner

  opt[:config_file] = Pathname.new(Dir.home) + '.genevalidatorapp.conf'
  opts.on('-c', '--config CONFIG_FILE', 'The Path to the configuration file',
          'By default, GeneValidatorapp searches the home directory,',
          '("~/genevalidatorapp.conf") for the configuration file.') do |config_file|
    opt[:config_file] = config_file
  end

  opt[:debug] = false
  opts.on('-d', '--debug', 'Provides more information on each step taken in',
          ' this program (which can also help for debugging)') do
    opt[:debug] = true
  end

  opt[:port] = 4567
  opts.on('-p', '--port PORT', 'The port at whihc to run the app.') do |port|
    opt[:port] = port
  end

  opt[:num_threads] = 1
  opts.on('-n', '--num_threads num_of_threads', Integer, 'Run the resource heavy BLAST (&',
          ' Mafft) with more than one thread.') do |num_threads|
    opt[:num_threads] = num_threads
  end

  opts.on('-v', '--version', 'Shows version') do
    puts GeneValidatorApp::VERSION
    exit
  end

  opts.on('-h', '--help', 'Display this screen') do
    puts opts
    exit
  end
end
optparse.parse!

GeneValidatorApp.init(opt)
GeneValidatorApp.run