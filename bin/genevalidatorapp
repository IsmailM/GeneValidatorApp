#!/usr/bin/env ruby

require 'GeneValidatorApp'
require 'fileutils'

# AnuragPriyam:
# * check the manner in which temp files are stored and served.



#### BELOW is only run once - i.e. with the 


### App Arguments = TODO...
# First Argument - location of te DB_Root
db_root =  File.join(Dir.home, 'blastdb') # ARGV[0]

# Second Argument, the name of the default db 
 
tempdir = Dir.mktmpdir('GeneValidator_')



## Run TESTS 

puts # a blank line.
puts "Looking for Databases in #{db_root}..."
puts # a blank line.

dbs             = scan_blast_database_directory(db_root)
default_db      = choose_default(dbs)
default_db_name = default_db.keys[0]
# Create a one Hash for the the default and one for everything else...
#   This is so that I can easily set the default in the advanced parameters field on the web app.
# Remove the default db from the dbs hash.
dbs.delete(default_db_name)

puts 'Testing if Genevalidator (and all it\'s dependencies) are working.'
check_genevalidator_works(tempdir, default_db_name)
puts # a blank line
puts 'All pre-run tests have passed.'
puts # a blank line


GVapp.set :app_root, File.join("#{File.dirname(__FILE__)}", '..')
GVapp.set :non_default, dbs
GVapp.set :default_db, default_db
GVapp.set :tempdir, tempdir
GVapp.run!
